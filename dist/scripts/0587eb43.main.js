!function(){localStorage.clear();window.Tweetsaster=Ember.Application.create({})}(),function(){Tweetsaster.truncStrRec=function(a,b,c){var d=a.split("<br>");if(b>d.length-1||d[b].length<c)return a;var e=d[b],f=e.substring(0,c),g=e.substring(c,e.length),h=f+"<br>"+g;return d[b]=h,Tweetsaster.truncStrRec(d.join("<br>"),b+1,c)},Tweetsaster.truncStr=function(a){var b=new Array,c=27;return a.split(" ").forEach(function(a){a.length>c?(newStr=Tweetsaster.truncStrRec(a,0,c),b.push(newStr)):b.push(a)}),a=b.join(" ")}}(),function(){Tweetsaster.ScrollTopMixin=Ember.Mixin.create({actions:{willTransition:function(){window.scrollTo(0,0)}}})}(),function(){Tweetsaster.timePassedFrom=function(a){var b,c=new Date(a),d=new Date,e=864e5,f=(d-c)/e;switch(!0){case 0==parseInt(24*f*60*60):b="ahora";break;case 61>24*f*60*60:b=parseInt(24*f*60*60)+"s";break;case 60>24*f*60:b=parseInt(24*f*60)+"m";break;case 24>24*f:b=parseInt(24*f)+"h";break;default:b=parseInt(f)+"d"}return b},Tweetsaster.TweetController=Ember.ObjectController.extend({timePassed:function(){return Tweetsaster.timePassedFrom(this.get("created_at"))}.property("created_at")})}(),function(){Tweetsaster.TweetsController=Ember.ObjectController.extend({title:"",searchString:"",searchBarVisible:!1,actions:{toggleSearchBar:function(){this.toggleProperty("searchBarVisible"),this.set("searchString","")},hideSearchBar:function(){this.set("searchBarVisible",!1),this.set("searchString","")},getMoreSearch:function(a){var b=Ember.Router.QueryParameters.create({query:a});this.transitionToRoute("tweets.search",b)}}})}(),function(){Tweetsaster.getLastIdFrom=function(a,b){return"bottom"===b?a.get("lastObject").get("id"):a.get("firstObject").get("id")},Tweetsaster.ghashtags=function(a,b){return"bottom"===b?a.get("lastObject").get("id"):a.get("firstObject").get("id")},Tweetsaster.updateControllerIDs=function(a,b,c){"bottom"===b?a<c.get("lastID")&&c.set("lastID",a):a>c.get("lastID")&&c.set("firstID",a)},Tweetsaster.moreBottomTweets=function(a,b){var c=!0;20!=a.length&&(c=!1),b.set("moreBottomTweets",c)},Tweetsaster.getMoreTweets=function(a,b){if(!b.get("gettingMore")){b.set("gettingMore",!0);var c=Tweetsaster.getLastIdFrom(b.get("arrangedContent"),a),d=b.store;$.get("http://alarmer.herokuapp.com/tweets?quantity="+b.get("tweetsPerRequest")+"&position="+a+"&id="+c).always(function(){b.set("gettingMore",!1)}).then(function(c){c.forEach(function(c){Tweetsaster.updateControllerIDs(c.id,a,b),d.push("tweet",{id:c.id,text:Tweetsaster.truncStr(c.text),created_at:c.created_at,channel:c.channel})}),"bottom"===a&&Tweetsaster.moreBottomTweets(c,b)})}},Tweetsaster.TweetsIndexController=Ember.ArrayController.extend({needs:"tweets",sortProperties:["id"],sortAscending:!1,gettingMore:!1,tweetsPerRequest:20,lastID:!1,firstID:!1,moreBottomTweets:!0,tweetsCount:function(){return this.get("arrangedContent.length")}.property("length"),hasTweets:function(){return this.get("tweetsCount")>0}.property("tweetsCount"),showingSpinner:function(){return this.get("tweetsCount")>10&&this.get("moreBottomTweets")}.property("length","moreBottomTweets"),actions:{getMoreBottom:function(){Tweetsaster.getMoreTweets("bottom",this)},getMoreTop:function(){Tweetsaster.getMoreTweets("top",this)}}})}(),function(){Tweetsaster.TweetsSearchController=Ember.ArrayController.extend({hasTweets:function(){return this.get("length")}.property("length"),showSpinner:!1})}(),function(){Tweetsaster.TweetsTweetoutController=Ember.ArrayController.extend({text:null,selectedChannel:"",needs:["tweetsIndex"],channels:[{value:"",label:"#generico"},{value:"earthquakes",label:"#terremotos"},{value:"fires",label:"#incendios"}],actions:{tweet:function(){var a=new Date,b=(a.toISOString(),this.get("text")),c=this.get("selectedChannel"),d="";""!==c&&(d+=" #"+c),d+=" #tweetsaster";var e=b+d;$.post("http://alarmer.herokuapp.com/tweets",{text:e}),this.set("text",""),this.set("selectedChannel",""),this.transitionToRoute(""===c?"tweets":"tweets."+c)}}})}(),function(){Tweetsaster.ApplicationAdapter=DS.RESTAdapter.extend({})}(),function(){Tweetsaster.Tweet=DS.Model.extend({text:DS.attr("string"),created_at:DS.attr("string"),channel:DS.attr("string")})}(),function(){Tweetsaster.TweetsEarthquakesRoute=Ember.Route.extend(Tweetsaster.ScrollTopMixin,{beforeModel:function(){this.controllerFor("tweets").send("hideSearchBar");var a=this.store;$.get("http://alarmer.herokuapp.com/tweets?quantity=20&position=top&channel=earthquakes").then(function(b){a.pushMany("tweet",b)})},model:function(){return this.store.filter("tweet",function(a){return"earthquakes"===a.get("channel")})},renderTemplate:function(a){this.render("tweets/index",{controller:a})},controllerName:"tweetsIndex",setupController:function(a,b){this.controllerFor("tweets").set("title","Canal: Terremotos"),this._super(a,b)}})}(),function(){Tweetsaster.TweetsFiresRoute=Ember.Route.extend(Tweetsaster.ScrollTopMixin,{beforeModel:function(){this.controllerFor("tweets").send("hideSearchBar");var a=this.store;$.get("http://alarmer.herokuapp.com/tweets?quantity=20&position=top&channel=fires").then(function(b){a.pushMany("tweet",b)})},model:function(){return this.store.filter("tweet",function(a){return"fires"===a.channel})},renderTemplate:function(a){this.render("tweets/index",{controller:a})},setupController:function(a,b){this.controllerFor("tweets").set("title","Canal: Incendios"),this._super(a,b)},controllerName:"tweetsIndex"})}(),function(){Tweetsaster.TweetsIndexRoute=Ember.Route.extend(Tweetsaster.ScrollTopMixin,{beforeModel:function(){this.controllerFor("tweets").send("hideSearchBar");var a=this.store;$.get("http://alarmer.herokuapp.com/tweets?quantity=20&position=bottom&id=538f7d9a9da29ffccb3c13db").then(function(b){a.pushMany("tweet",b)})},model:function(){return this.store.filter("tweet")},setupController:function(a,b){this.controllerFor("tweets").set("title","Canal: Todas"),this._super(a,b)}})}(),function(){Tweetsaster.TweetsRoute=Ember.Route.extend(Tweetsaster.ScrollTopMixin,{setupController:function(a,b){this.controllerFor("tweets").set("title","Terremotos"),this._super(a,b)}})}(),function(){Tweetsaster.TweetsSearchRoute=Ember.Route.extend({observesParameters:["query"],model:function(){var a=this.get("queryParameters");return $.get("http://alarmer.herokuapp.com/tweets?quantity=20&position=search&query="+a.query)},renderTemplate:function(){this.render("tweets.index",{controller:"tweets.search"})},setupController:function(a,b){this.controllerFor("tweets").set("title","Buscar"),this._super(a,b)}})}(),function(){Tweetsaster.TweetsTweetoutRoute=Ember.Route.extend({setupController:function(a,b){this.controllerFor("tweets").send("hideSearchBar"),this.controllerFor("tweets").set("title","Componer Mensaje"),this._super(a,b)}})}(),function(){Tweetsaster.TweetsIndexView=Ember.View.extend({didScroll:function(){this.isScrolledToBottom()&&this.get("controller").send("getMoreBottom")},isScrolledToBottom:function(){var a=window.pageYOffset,b=$(document).height()-$(window).height();return 0===a?!1:a>b-100},didInsertElement:function(){$(window).on("scroll",$.proxy(this.didScroll,this)),view=this,$("#hook").hook({reloadPage:!1,reloadEl:function(){view.get("controller").send("getMoreTop")},swipeDistance:100})},willDestroyElement:function(){$(window).off("scroll",$.proxy(this.didScroll,this))}})}(),function(){Tweetsaster.TweetsView=Ember.View.extend({fastClick:function(){FastClick.attach(document.body)},enableActivePseudoStyles:function(){document.addEventListener("touchstart",function(){},!1)},didInsertElement:function(){this.fastClick(),this.enableActivePseudoStyles()}})}(),function(){Tweetsaster.FocusTextAreaComponent=Ember.TextArea.extend({becomeFocused:function(){this.$().focus()}.on("didInsertElement")})}(),function(){Tweetsaster.SearchBarComponent=Ember.Component.extend({scrollToTop:function(){window.scrollTo(0,0),$(window).on("touchmove",function(){var a=$("#search-field");a.blur()}),$("#search-field").on("focus",function(){if(0!=window.pageYOffset){var a=$("#search-field");a.blur(),window.scrollTo(0,0)}})}.on("didInsertElement"),actions:{search:function(){this.sendAction("search",this.get("query"))}}})}(),function(){Tweetsaster.Router.map(function(){this.resource("tweets",{path:"/"},function(){this.route("earthquakes"),this.route("fires"),this.route("search"),this.route("tweetout")})})}(),function(){!function(){var a=Ember.merge,b=Ember.keys,c=Array.prototype.slice;Ember.Router.reopen({queryString:"",queryParameters:function(a,b){return 2===arguments.length?(this.set("queryString",f(b)),b):g(this.get("queryString"))}.property("queryString"),handleURL:function(a){var b=a.split("?",2),c=i(this.router),d=this;return this.set("queryString",b.length<2?"":b[1]),this._super(b[0]).then(function(){d.updateParameterContexts(c)})},synchronizeURL:function(){var a=this.location.getURL(),b=a.split("?",1)[0],c=this.get("queryString");c&&(b+="?"+c),b!==a&&this.location.setURL(b)},startRouting:function(){this._super();var a=this.router,b=a.updateURL,c=this;a.updateURL=function(d){var e=c.get("queryString");e&&(d+="?"+e),b.call(a,d)}},transitionTo:function(a){var b=h(this.router,a,c.call(arguments,1)),d=i(this.router);this.set("queryParameters",b.queryParams);var e=this._super.apply(this,b.args),f=this;return e.promise.then(function(){f.updateParameterContexts(d)&&f.synchronizeURL()}),e},generate:function(a){var b=h(this.router,a,c.call(arguments,1)),d=this._super.apply(this,b.args),e=f(b.queryParams);return e&&(d+="?"+e),d},updateParameterContexts:function(a){for(var b=this.router.currentHandlerInfos,c=!1,e=0,f=b.length;f>e;e++){var g=b[e],h=g.handler,i=a[e],j=h.observesParameters,k=j&&(j===!0||Ember.isArray(j));if(k&&h.modelWithQuery){var l=h.get("queryParameters");if(i&&i.name===g.name&&i.context===h.context){if(d(h.currentQueryParams,l)){c=!0;var m=function(){var a=h;return function(){return a.modelWithQuery()}}(),n=function(){var a=h.controllerFor(h.controllerName||h.routeName),b=h;return function(c){b.context=c,b.contextDidChange&&b.contextDidChange(),b.setupController(a,c)}}();h.currentQueryParams=l,Ember.RSVP.resolve().then(m).then(n)}}else h.currentQueryParams=l}}return c}}),Ember.Router.QueryParameters=Ember.Object.extend(),Ember.Route.reopen({queryParameters:function(){return e(this.get("router.queryParameters"),this.get("observesParameters"))}.property("router.queryParameters"),modelWithQuery:function(){return this.model.apply(this,arguments)}});var d=function(a,c){var d=b(a);if(d.length!=b(c).length)return!0;for(var e=0,f=d.length;f>e;e++)if(a[d[e]]!==c[d[e]])return!0;return!1},e=function(b,c){var d={};return c=c||[],"boolean"==typeof c?c?d:a(d,b):(c.forEach(function(a){a in b&&(d[a]=b[a])}),d)},f=function(a){var b=[];for(var c in a)if(a.hasOwnProperty(c)&&a[c]){var d=encodeURIComponent(c);b.push(a[c]===!0?d:d+"="+encodeURIComponent(a[c])),b.push()}return b.join("&")},g=function(a){var b=a.split("&"),c={};return b.forEach(function(a){if(a){var b,d,e=a.split("=",2);d=e.length<2?!0:decodeURIComponent(e[1]),b=decodeURIComponent(e[0]),c[b]=d}}),c},h=function(c,d,e){var f,g,h,i={},k=c.currentHandlerInfos||[];if(e[0]&&e[0]instanceof Ember.Router.QueryParameters){var l=e.shift();f=l.getProperties(b(l))}c.hasRoute(d)||(d+=".index"),g=c.recognizer.handlersFor(d),h=j(c,g,e);for(var m=(k.length,0);h>m;m++){var n=k[m],o=n.handler;o.currentQueryParams&&a(i,o.currentQueryParams)}return f&&a(i,f),b(i).forEach(function(a){i[a]||delete i[a]}),{contexts:e,queryParams:i,args:[d].concat(e)}},i=function(a){for(var b=[],c=a.currentHandlerInfos||[],d=0,e=c.length;e>d;d++){var f=c[d];b.push({name:f.name,context:f.handler.context})}return b},j=function(a,b,c){var d,e=b.length-1,f=a.currentHandlerInfos||[],g=c.length;for(d=b.length-1;d>=0;d--){var h=b[d],i=h.handler,j=f[d],k=!1;j&&j.name===i||(k=!0),(h.isDynamic||h.names&&h.names.length)&&g&&(g--,k=!0),k&&(e=d)}return e}}()}();