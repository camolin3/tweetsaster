!function(){localStorage.clear();var a=window.Tweetsaster=Ember.Application.create({initialize:function(){}});a.truncStrRec=function(b,c,d){var e=b.split("<br>");if(c>e.length-1||e[c].length<d)return b;var f=e[c],g=f.substring(0,d),h=f.substring(d,f.length),i=g+"<br>"+h;return e[c]=i,a.truncStrRec(e.join("<br>"),c+1,d)},a.truncStr=function(b){var c=new Array,d=27;return b.split(" ").forEach(function(b){b.length>d?(newStr=a.truncStrRec(b,0,d),c.push(newStr)):c.push(b)}),b=c.join(" ")},a.FocusTextAreaComponent=Ember.TextArea.extend({becomeFocused:function(){this.$().focus()}.on("didInsertElement")}),a.ScrollTopMixin=Ember.Mixin.create({actions:{willTransition:function(){window.scrollTo(0,0)}}})}(),function(){Tweetsaster.TweetController=Ember.ObjectController.extend({timePassed:function(){var a,b=new Date(this.get("model.created_at")),c=new Date,d=864e5,e=(c-b)/d;switch(!0){case 0==parseInt(24*e*60*60):a="ahora";break;case 61>24*e*60*60:a=parseInt(24*e*60*60)+"s";break;case 60>24*e*60:a=parseInt(24*e*60)+"m";break;case 24>24*e:a=parseInt(24*e)+"h";break;default:a=parseInt(e)+"d"}return a}.property("created_at")})}(),function(){Tweetsaster.TweetsController=Ember.ObjectController.extend({title:"",searchBarVisible:!1,actions:{toggleSearchBar:function(){this.toggleProperty("searchBarVisible")}}})}(),function(){Tweetsaster.TweetsIndexController=Ember.ArrayController.extend({sortProperties:["id"],sortAscending:!1,gettingMore:!1,page:1,tweetsPerPage:20,lastID:!1,actions:{getMore:function(){if(!this.get("gettingMore")){console.log("getting more"),this.set("gettingMore",!0);var a=this,b=this.get("model"),c=this.store,d=b.get("lastObject").get("id");console.log(d),$.get("http://alarmer.herokuapp.com/tweets?quantity="+a.get("tweetsPerPage")+"&position=bottom&id="+d).then(function(b){b.forEach(function(b){mongoID=b.id,d>mongoID&&a.set("lastID",mongoID),c.push("tweet",{id:b.id,text:Tweetsaster.truncStr(b.text),created_at:b.created_at,channel:b.channel})}),page=a.get("page"),a.set("page",page+1),console.log("page "+a.page),a.set("gettingMore",!1)})}}}})}(),function(){Tweetsaster.TweetsTweetoutController=Ember.ArrayController.extend({text:null,selectedChannel:"",needs:["tweetsIndex"],channels:[{value:"",label:"#generico"},{value:"earthquakes",label:"#terremotos"},{value:"fires",label:"#incendios"}],actions:{tweet:function(){var a=new Date,b=(a.toISOString(),this.get("text")),c=this.get("selectedChannel"),d="";""!==c&&(d=" #"+c);var e=b+d+" #tweetsaster";$.post("http://alarmer.herokuapp.com/tweets",{text:e}),this.set("text",""),this.set("selectedChannel",""),this.transitionToRoute(""===c?"tweets":"tweets."+c)}}})}(),function(){Tweetsaster.ApplicationSerializer=DS.LSSerializer.extend(),Tweetsaster.ApplicationAdapter=DS.RESTAdapter.extend({}),DS.RESTAdapter.reopen({host:"https://alarmer.herokuapp.com"})}(),function(){Tweetsaster.Tweet=DS.Model.extend({text:DS.attr("string"),created_at:DS.attr("string"),channel:DS.attr("string")})}(),function(){Tweetsaster.TweetsEarthquakesRoute=Ember.Route.extend(Tweetsaster.ScrollTopMixin,{beforeModel:function(){var a=this.store;$.get("http://alarmer.herokuapp.com/tweets?quantity=20&position=top&channel=earthquakes").then(function(b){a.pushMany("tweet",b)})},model:function(){return this.store.filter("tweet",function(a){return"earthquakes"===a.get("channel")})},renderTemplate:function(a){this.render("tweets/index",{controller:a})},controllerName:"tweetsIndex",setupController:function(a,b){this.controllerFor("tweets").set("title","Canal: Terremotos"),a.set("model",b),a.set("page",1)}})}(),function(){Tweetsaster.TweetsFiresRoute=Ember.Route.extend(Tweetsaster.ScrollTopMixin,{beforeModel:function(){var a=this.store;$.get("http://alarmer.herokuapp.com/tweets?quantity=20&position=top&channel=fires").then(function(b){a.pushMany("tweet",b)})},model:function(){return this.store.filter("tweet",function(a){return"fires"===a.channel})},renderTemplate:function(a){this.render("tweets/index",{controller:a})},setupController:function(a,b){this.controllerFor("tweets").set("title","Canal: Incendios"),a.set("model",b),a.set("page",1)},controllerName:"tweetsIndex"})}(),function(){Tweetsaster.TweetsIndexRoute=Ember.Route.extend(Tweetsaster.ScrollTopMixin,{beforeModel:function(){var a=this.store;$.get("http://alarmer.herokuapp.com/tweets?quantity=20&position=top").then(function(b){a.pushMany("tweet",b)})},model:function(){return this.store.filter("tweet")},setupController:function(a,b){this.controllerFor("tweets").set("title","Canal: Todas"),a.set("model",b),a.set("page",1)}})}(),function(){Tweetsaster.TweetsRoute=Ember.Route.extend({setupController:function(){this.controllerFor("tweets").set("title","Terremotos")}})}(),function(){Tweetsaster.TweetsTweetoutRoute=Ember.Route.extend({setupController:function(){this.controllerFor("tweets").set("title","Componer Mensaje")}})}(),function(){Tweetsaster.TweetsIndexView=Ember.View.extend({didScroll:function(){this.isScrolledToBottom()&&this.get("controller").send("getMore")},isScrolledToBottom:function(){var a=window.pageYOffset,b=$(document).height()-$(window).height();return 0===a?!1:a>b-100},didInsertElement:function(){console.log("insert"),$(window).on("scroll",$.proxy(this.didScroll,this))},willDestroyElement:function(){console.log("destroy"),$(window).off("scroll",$.proxy(this.didScroll,this))}})}(),function(){Tweetsaster.TweetsView=Ember.View.extend({fastClick:function(){console.log("fast"),FastClick.attach(document.body)},enableActivePseudoStyles:function(){document.addEventListener("touchstart",function(){},!1)},didInsertElement:function(){this.fastClick(),this.enableActivePseudoStyles()}})}(),function(){Tweetsaster.Router.map(function(){this.resource("tweets",{path:"/"},function(){this.route("earthquakes"),this.route("fires"),this.route("tweetout")})})}();